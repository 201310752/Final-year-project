9999999999s:3094:"'use strict';System.register('botfactoryit/imgur-upload/main',['flarum/extend','flarum/components/TextEditor','flarum/components/Button'],function(_export,_context){"use strict";var extend,TextEditor,Button;function isNumber(x){return!(isNaN(x)||x=='')}
return{setters:[function(_flarumExtend){extend=_flarumExtend.extend},function(_flarumComponentsTextEditor){TextEditor=_flarumComponentsTextEditor.default},function(_flarumComponentsButton){Button=_flarumComponentsButton.default}],execute:function(){app.initializers.add('botfactoryit-imgur-upload',function(){extend(TextEditor.prototype,'controlItems',function(items){items.add('imgur-upload',m('div',{'class':'Button hasIcon imgur-upload-button'},m('i',{'class':'icon fa fa-fw fa-picture-o Button-icon'}),m('span',{'class':'Button-label'}),m('input',{type:'file',accept:'image/*',id:'imgur-upload-input',name:'imgur-upload-input'})));if(this.props.preview){var previewButton=items.get('preview');items.remove('preview');items.add('preview',previewButton)}});extend(TextEditor.prototype,'init',function(){var _this=this;$('#composer').on('change','#imgur-upload-input',function(){var buttonDiv=$('.imgur-upload-button');var icon=$('.imgur-upload-button > i');var buttonText=$('.imgur-upload-button > span.Button-label');var submitButton=$('.item-submit > button');icon.removeClass('fa-picture-o').addClass('fa-spin fa-circle-o-notch');buttonText.text(app.translator.trans('botfactoryit-imgur-upload.forum.loading')[0]);buttonDiv.addClass('loading');submitButton.attr('disabled',!0);var file=$("#imgur-upload-input")[0].files[0];var formData=new FormData();formData.append('image',file);$.ajax({url:'https://api.imgur.com/3/image',headers:{'Authorization':'Client-ID '+app.forum.attribute('botfactoryit.imgur-upload.client_id')},type:'POST',data:formData,cache:!1,contentType:!1,processData:!1,success:function success(response){icon.removeClass('fa-spin fa-circle-o-notch').addClass('fa-check green');buttonText.text(app.translator.trans('botfactoryit-imgur-upload.forum.loaded')[0]);var imageLink=response.data.link;var thumbnailLink=imageLink;if(response.data.width>1024){var extensionIndex=thumbnailLink.lastIndexOf('.');thumbnailLink=thumbnailLink.slice(0,extensionIndex)+'h'+thumbnailLink.slice(extensionIndex)}
var stringToInject='';stringToInject+='[URL='+imageLink+']';stringToInject+='[IMG]'+thumbnailLink+'[/IMG]';stringToInject+='[/URL]';stringToInject+='\n';_this.insertAtCursor(stringToInject);$('#imgur-upload-input').val('');setTimeout(function(){submitButton.attr('disabled',!1);icon.removeClass('fa-check green').addClass('fa-picture-o');buttonDiv.removeClass('loading');buttonText.text('')},2000)},error:function error(response){icon.removeClass('fa-spin fa-circle-o-notch').addClass('fa-times red');buttonText.text(app.translator.trans('botfactoryit-imgur-upload.forum.error')[0]);buttonDiv.removeClass('loading');console.log(response);setTimeout(function(){submitButton.attr('disabled',!1);icon.removeClass('fa-times red').addClass('fa-picture-o');buttonDiv.removeClass('loading');buttonText.text('')},2000)}})})})})}}})";