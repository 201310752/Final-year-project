9999999999s:3513:"System.register('matpompili/imgur-upload/main',['flarum/extend','flarum/components/TextEditor','flarum/components/Button'],function(_export){'use strict';var extend,TextEditor,Button;function isNumber(x){return!(isNaN(x)||x=='')}
return{setters:[function(_flarumExtend){extend=_flarumExtend.extend},function(_flarumComponentsTextEditor){TextEditor=_flarumComponentsTextEditor['default']},function(_flarumComponentsButton){Button=_flarumComponentsButton['default']}],execute:function(){app.initializers.add('matpompili-imgur-upload',function(){extend(TextEditor.prototype,'controlItems',function(items){items.add('imgur-upload',m('div',{'class':'Button hasIcon imgur-upload-button'},m('i',{'class':'icon fa fa-fw fa-paperclip Button-icon'}),m('span',{'class':'Button-label'},app.translator.trans('matpompili-imgur-upload.forum.attach')),m('input',{type:'file',accept:'image/*',id:'imgur-upload-input',name:'imgur-upload-input'})));if(this.props.preview){items.remove('preview');items.add('preview',Button.component({icon:'eye',className:'Button Button--icon',onclick:this.props.preview}))}});extend(TextEditor.prototype,'init',function(){var textAreaObj=this;$("#composer").on("change","#imgur-upload-input",function(){var reader=new FileReader();reader.onload=function(e){var icon=$(".imgur-upload-button > i");var buttonText=$(".imgur-upload-button > span.Button-label");var submitButton=$(".item-submit > button");icon.removeClass('fa-paperclip').addClass('fa-spin fa-circle-o-notch');buttonText.text(app.translator.trans('matpompili-imgur-upload.forum.loading')[0]);submitButton.attr("disabled",!0);var canvas=document.createElement('canvas'),ctx=canvas.getContext('2d'),img=new Image();var maxWidth=app.forum.attribute('maxImageWidth'),maxHeight=app.forum.attribute('maxImageHeight');img.onload=function(){var scale=1;if(isNumber(maxWidth)&&isNumber(maxHeight)){scale=Math.min(maxWidth/img.width,maxHeight/img.height);scale=Math.min(scale,1)}
canvas.width=img.width*scale;canvas.height=img.height*scale;ctx.drawImage(img,0,0,canvas.width,canvas.height);var resizedImage=canvas.toDataURL();var data=resizedImage.substr(resizedImage.indexOf(",")+1,resizedImage.length);console.log('now we have the resizedImage');$.ajax({url:'https://api.imgur.com/3/image',headers:{'Authorization':'Client-ID '+app.forum.attribute('imgurClientID')},type:'POST',data:{'image':data,'type':'base64'},success:function success(response){icon.removeClass('fa-spin fa-circle-o-notch').addClass('fa-check green');buttonText.text(app.translator.trans('matpompili-imgur-upload.forum.loaded')[0]);var linkString='\n![alt text]('+response.data.link.replace('http:','https:')+')\n';textAreaObj.insertAtCursor(linkString);$("#imgur-upload-input").val("");if(typeof textAreaObj.props.preview!=='undefined'){textAreaObj.props.preview()}
setTimeout(function(){submitButton.attr("disabled",!1);icon.removeClass('fa-check green').addClass('fa-paperclip');buttonText.text(app.translator.trans('matpompili-imgur-upload.forum.attach')[0])},1000)},error:function error(response){icon.removeClass('fa-spin fa-circle-o-notch').addClass('fa-times red');buttonText.text(app.translator.trans('matpompili-imgur-upload.forum.error')[0]);console.log(response);setTimeout(function(){submitButton.attr("disabled",!1);icon.removeClass('fa-times red').addClass('fa-paperclip');buttonText.text(app.translator.trans('matpompili-imgur-upload.forum.attach')[0])},1000)}})};img.src=e.target.result};reader.readAsDataURL($("#imgur-upload-input")[0].files[0])})})})}}})";