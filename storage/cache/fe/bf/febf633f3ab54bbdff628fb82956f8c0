9999999999s:3330:"System.register('flagrow/image-upload/components/UploadButton',['flarum/Component','flarum/helpers/icon','flarum/components/LoadingIndicator'],function(_export){'use strict';var Component,icon,LoadingIndicator,UploadButton;return{setters:[function(_flarumComponent){Component=_flarumComponent['default']},function(_flarumHelpersIcon){icon=_flarumHelpersIcon['default']},function(_flarumComponentsLoadingIndicator){LoadingIndicator=_flarumComponentsLoadingIndicator['default']}],execute:function(){UploadButton=(function(_Component){babelHelpers.inherits(UploadButton,_Component);function UploadButton(){babelHelpers.classCallCheck(this,UploadButton);babelHelpers.get(Object.getPrototypeOf(UploadButton.prototype),'constructor',this).apply(this,arguments)}
babelHelpers.createClass(UploadButton,[{key:'init',value:function init(){this.textAreaObj=null;this.loading=!1}},{key:'view',value:function view(){return m('div',{className:'Button hasIcon flagrow-image-upload-button Button--icon'},[this.loading?LoadingIndicator.component({className:'Button-icon'}):icon('picture-o',{className:'Button-icon'}),m('span',{className:'Button-label'},this.loading?app.translator.trans('flagrow-image-upload.forum.states.loading'):app.translator.trans('flagrow-image-upload.forum.buttons.attach')),m('form#flagrow-image-upload-form',[m('input',{type:'file',accept:'image/*',name:'flagrow-image-upload-input',onchange:this.process.bind(this)})])])}},{key:'process',value:function process(e){var data=new FormData();data.append('image',$(e.target)[0].files[0]);this.loading=!0;m.redraw();app.request({method:'POST',url:app.forum.attribute('apiUrl')+'/image/upload',serialize:function serialize(raw){return raw},data:data}).then(this.success.bind(this),this.failure.bind(this))}},{key:'failure',value:function failure(message){}},{key:'success',value:function success(image){var _this=this;var link=image.data.attributes.url;var markdownString='\n![image '+link+']('+link+')\n';this.textAreaObj.insertAtCursor(markdownString);if(typeof this.textAreaObj.props.preview!=='undefined'){this.textAreaObj.props.preview()}
setTimeout(function(){document.getElementById("flagrow-image-upload-form").reset();_this.loading=!1},1000)}}]);return UploadButton})(Component);_export('default',UploadButton)}}});System.register('flagrow/image-upload/main',['flarum/extend','flarum/components/TextEditor','flagrow/image-upload/components/UploadButton'],function(_export){'use strict';var extend,TextEditor,UploadButton;return{setters:[function(_flarumExtend){extend=_flarumExtend.extend},function(_flarumComponentsTextEditor){TextEditor=_flarumComponentsTextEditor['default']},function(_flagrowImageUploadComponentsUploadButton){UploadButton=_flagrowImageUploadComponentsUploadButton['default']}],execute:function(){app.initializers.add('flagrow-image-upload',function(app){extend(TextEditor.prototype,'controlItems',function(items){if(!app.forum.attribute('canUploadImages'))return;var uploadButton=new UploadButton();uploadButton.textAreaObj=this;items.add('flagrow-image-upload',uploadButton,0);$(".Button-label",".item-flagrow-image-upload > div").hide();$(".item-flagrow-image-upload > div").hover(function(){$('.Button-label',this).show();$(this).removeClass('Button--icon')},function(){$('.Button-label',this).hide();$(this).addClass('Button--icon')})})})}}})";